version: '2'
services:
  core:
    image: jeguzzi/ros:armhf-kinetic-ros-dev
    network_mode: host
    command: roscore
    restart: always
    env_file:
      - ./ros.env
    volumes:
      - ./logs:/root/.ros/log:rw
  robot:
    build: .
    image: jeguzzi/thymioid
    network_mode: host
    privileged: true
    command: roslaunch --wait thymioid robot.launch
    restart: always
    env_file:
      - ./ros.env
    volumes:
      - ./logs:/root/.ros/log:rw
    depends_on:
      - core
  camera:
    image: jeguzzi/thymioid
    network_mode: host
    privileged: true
    restart: always
    command: roslaunch --wait thymioid camera.launch rectify:=false
    restart: always
    env_file:
      - ./ros.env
    volumes:
      - ./logs:/root/.ros/log:rw
    depends_on:
      - core
  ups:
    image: jeguzzi/thymioid
    network_mode: host
    privileged: true
    command: roslaunch --wait thymioid ups.launch
    restart: always
    env_file:
      - ./ros.env
    volumes:
      - ./logs:/root/.ros/log:rw
    depends_on:
      - core
  ui:
    image: jeguzzi/thymioid
    network_mode: host
    privileged: true
    command: roslaunch --wait thymioid ui.launch
    restart: always
    env_file:
      - ./ros.env
    volumes:
      - ./logs:/root/.ros/log:rw
  portainer:
    image: portainer/portainer:linux-arm
    # command: --host=unix:///var/run/docker.sock
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    ports:
      - 9000:9000
    restart: always
